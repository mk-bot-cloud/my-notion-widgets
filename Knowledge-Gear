<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progress Gear Box</title>
    <style>
        :root {
            --bg-color: #191919;
            --card-bg: #212121;
            --border: #373737;
            --text: #efefef;
            --accent: #2383e2;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text);
            font-family: sans-serif;
            margin: 0;
            padding: 15px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        .widget {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
        }
        h3 { margin-top: 0; font-size: 0.9rem; color: #888; border-bottom: 1px solid var(--border); padding-bottom: 8px; }
        textarea, input, select {
            width: 100%; background: #2c2c2c; border: 1px solid var(--border);
            color: white; border-radius: 4px; padding: 8px; box-sizing: border-box; margin-bottom: 10px;
        }
        button {
            background: var(--accent); color: white; border: none; padding: 8px 12px;
            border-radius: 4px; cursor: pointer; width: 100%;
        }
        .result { background: #111; padding: 8px; font-size: 0.85rem; border-radius: 4px; min-height: 20px; white-space: pre-wrap; }
        .progress-container { background: #333; border-radius: 10px; height: 10px; margin: 10px 0; }
        .progress-bar { background: var(--accent); height: 100%; border-radius: 10px; transition: width 0.3s; }
    </style>
</head>
<body>

<div class="widget">
    <h3>ğŸ“ åŸ·ç­†ãƒ»è¬›ç¾©ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h3>
    <textarea id="textInput" placeholder="ã“ã“ã«åŸç¨¿ã‚’ãƒšãƒ¼ã‚¹ãƒˆ..." rows="4"></textarea>
    <div style="display: flex; gap: 10px; font-size: 0.8rem;">
        <div>æ–‡å­—æ•°: <span id="charCount">0</span></div>
        <div>æƒ³å®šæ™‚é–“: <span id="timeEst">0</span> åˆ†</div>
    </div>
    <div class="progress-container"><div id="targetBar" class="progress-bar" style="width: 0%"></div></div>
    <input type="number" id="targetCount" placeholder="ç›®æ¨™æ–‡å­—æ•° (ä¾‹: 2000)" style="font-size: 0.7rem;">
</div>

<div class="widget">
    <h3>ğŸ“š Citation Generator</h3>
    <input type="text" id="auth" placeholder="è‘—è€…å (ä¾‹: å±±ç”°å¤ªéƒ)">
    <input type="text" id="year" placeholder="ç™ºè¡Œå¹´ (ä¾‹: 2024)">
    <input type="text" id="title" placeholder="è«–æ–‡ã‚¿ã‚¤ãƒˆãƒ«">
    <button onclick="generateCitation()">APAå½¢å¼ã§ã‚³ãƒ”ãƒ¼</button>
    <div id="citeResult" class="result" style="margin-top:10px; display:none;"></div>
</div>

<div class="widget">
    <h3>â³ Life Progress (Year)</h3>
    <div id="yearLabel" style="font-size: 0.8rem; margin-bottom: 5px;"></div>
    <div class="progress-container"><div id="yearBar" class="progress-bar"></div></div>
    <div id="dayCountdown" style="font-size: 1.2rem; font-weight: bold; text-align: center;"></div>
</div>

<div class="widget">
    <h3>ğŸ“Š çµ±è¨ˆæ¤œå®šãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼</h3>
    <select id="statType">
        <option value="none">ç›®çš„ã‚’é¸æŠ...</option>
        <option value="2group">2ç¾¤ã®å·®ã‚’æ¯”è¼ƒã—ãŸã„</option>
        <option value="multi">3ç¾¤ä»¥ä¸Šã®å·®ã‚’æ¯”è¼ƒã—ãŸã„</option>
        <option value="rel">2å¤‰æ•°ã®é–¢ä¿‚ã‚’çŸ¥ã‚ŠãŸã„</option>
    </select>
    <div id="statResult" class="result">æ¡ä»¶ã‚’é¸ã‚“ã§ãã ã•ã„</div>
</div>

<script>
    // 1. æ–‡å­—æ•°ãƒ»æ™‚é–“è¨ˆç®—
    const textInput = document.getElementById('textInput');
    textInput.addEventListener('input', () => {
        const text = textInput.value;
        const count = text.length;
        document.getElementById('charCount').innerText = count;
        // ä¸€èˆ¬çš„ãªèª­ã¿ä¸Šã’é€Ÿåº¦ 400æ–‡å­—/åˆ†ã§è¨ˆç®—
        document.getElementById('timeEst').innerText = (count / 400).toFixed(1);
        
        const target = document.getElementById('targetCount').value;
        if(target > 0) {
            const percent = Math.min((count / target) * 100, 100);
            document.getElementById('targetBar').style.width = percent + '%';
        }
    });

    // 2. Citationç”Ÿæˆ
    function generateCitation() {
        const a = document.getElementById('auth').value;
        const y = document.getElementById('year').value;
        const t = document.getElementById('title').value;
        const res = `${a} (${y}). ${t}.`;
        const el = document.getElementById('citeResult');
        el.innerText = res;
        el.style.display = 'block';
        navigator.clipboard.writeText(res);
    }

    // 3. ãƒ©ã‚¤ãƒ•ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¨ˆç®—
    function updateLife() {
        const now = new Date();
        const start = new Date(now.getFullYear(), 0, 1);
        const end = new Date(now.getFullYear() + 1, 0, 1);
        const percent = ((now - start) / (end - start)) * 100;
        document.getElementById('yearBar').style.width = percent + '%';
        document.getElementById('yearLabel').innerText = `${now.getFullYear()}å¹´ é€²æ—: ${percent.toFixed(1)}%`;
        
        const lastDay = new Date(now.getFullYear(), 11, 31);
        const diff = Math.ceil((lastDay - now) / (1000 * 60 * 60 * 24));
        document.getElementById('dayCountdown').innerText = `ä»Šå¹´ã®æ®‹ã‚Š: ã‚ã¨ ${diff} æ—¥`;
    }
    updateLife();

    // 4. çµ±è¨ˆãƒŠãƒ“ç°¡æ˜“ãƒ­ã‚¸ãƒƒã‚¯
    document.getElementById('statType').addEventListener('change', (e) => {
        const val = e.target.value;
        let res = "";
        if(val === "2group") res = "æ­£è¦åˆ†å¸ƒã‚ã‚Šï¼štæ¤œå®š\nãªã—ï¼šãƒãƒ³ãƒ»ãƒ›ã‚¤ãƒƒãƒˆãƒ‹ãƒ¼ã®Uæ¤œå®š";
        if(val === "multi") res = "æ­£è¦åˆ†å¸ƒã‚ã‚Šï¼šä¸€å…ƒé…ç½®åˆ†æ•£åˆ†æ\nãªã—ï¼šã‚¯ãƒ©ã‚¹ã‚«ãƒ«ãƒ»ã‚¦ã‚©ãƒªã‚¹æ¤œå®š";
        if(val === "rel") res = "æ­£è¦åˆ†å¸ƒã‚ã‚Šï¼šãƒ”ã‚¢ã‚½ãƒ³ã®ç›¸é–¢ä¿‚æ•°\nãªã—ï¼šã‚¹ãƒ”ã‚¢ãƒãƒ³ã®é †ä½ç›¸é–¢ä¿‚æ•°";
        document.getElementById('statResult').innerText = res || "æ¡ä»¶ã‚’é¸ã‚“ã§ãã ã•ã„";
    });
</script>
</body>
</html>
