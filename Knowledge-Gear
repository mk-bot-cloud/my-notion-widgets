<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progress Gear Box - Ultimate</title>
    <style>
        :root { --bg: #191919; --card: #222; --brd: #333; --txt: #efefef; --acc: #2383e2; }
        body { background: var(--bg); color: var(--txt); font-family: system-ui; margin: 0; padding: 10px; display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 10px; font-size: 13px; }
        .widget { background: var(--card); border: 1px solid var(--brd); border-radius: 8px; padding: 12px; display: flex; flex-direction: column; }
        h3 { margin: 0 0 10px 0; font-size: 0.8rem; color: #888; border-bottom: 1px solid #333; padding-bottom: 5px; display: flex; justify-content: space-between; }
        textarea, input, select { width: 100%; background: #2c2c2c; border: 1px solid #444; color: #fff; border-radius: 4px; padding: 6px; box-sizing: border-box; margin-bottom: 8px; font-size: 12px; }
        button { background: var(--acc); color: white; border: none; padding: 6px; border-radius: 4px; cursor: pointer; transition: 0.2s; }
        button:hover { opacity: 0.8; }
        .res { background: #111; padding: 6px; border-radius: 4px; min-height: 1.2rem; font-family: monospace; word-break: break-all; margin-top: 5px; }
        .bar-bg { background: #333; border-radius: 10px; height: 6px; margin: 5px 0; }
        .bar-fill { background: var(--acc); height: 100%; border-radius: 10px; width: 0%; transition: 0.5s; }
        .flex { display: flex; gap: 5px; align-items: center; }
    </style>
</head>
<body>

<div class="widget">
    <h3>ğŸ“ åŸ·ç­†ãƒ»è¬›ç¾©ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h3>
    <textarea id="txtIn" placeholder="åŸç¨¿ã‚’å…¥åŠ›..." rows="3"></textarea>
    <div class="flex">
        <span>ç›®å®‰: <b id="timeE">0</b>åˆ†</span>
        <input type="number" id="targ" placeholder="ç›®æ¨™æ•°" style="width:70px; margin:0;">
    </div>
    <div class="bar-bg"><div id="tBar" class="bar-fill"></div></div>
</div>

<div class="widget">
    <h3>ğŸ“š æ–‡çŒ®å¼•ç”¨ (APAé¢¨)</h3>
    <div class="flex">
        <input id="cA" placeholder="è‘—è€…"> <input id="cY" placeholder="å¹´" style="width:60px;">
    </div>
    <input id="cT" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
    <button onclick="copyCite()">å½¢å¼å¤‰æ› & ã‚³ãƒ”ãƒ¼</button>
</div>

<div class="widget">
    <h3>â± ãƒ—ãƒ¬ã‚¼ãƒ³é€²è¡Œç®¡ç†</h3>
    <div id="pClock" style="font-size: 1.5rem; text-align: center; margin: 5px 0;">00:00</div>
    <div class="flex">
        <button onclick="pStart()">Start</button>
        <button onclick="pReset()" style="background:#444">Reset</button>
    </div>
</div>

<div class="widget">
    <h3>ğŸ“Š çµ±è¨ˆæ‰‹æ³•ãƒŠãƒ“</h3>
    <select onchange="stat(this.value)">
        <option>ç›®çš„ã‚’é¸æŠ...</option>
        <option value="t">2ç¾¤ã®å·® (æ­£è¦åˆ†å¸ƒã‚ã‚Š)</option>
        <option value="u">2ç¾¤ã®å·® (æ­£è¦åˆ†å¸ƒãªã—)</option>
        <option value="a">3ç¾¤ä»¥ä¸Šã®å·®</option>
        <option value="r">ç›¸é–¢ã‚’çŸ¥ã‚ŠãŸã„</option>
    </select>
    <div id="sRes" class="res">æ‰‹æ³•ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
</div>

<div class="widget">
    <h3>â³ Life Progress</h3>
    <div id="lLab" style="font-size: 0.7rem;">Year Progress</div>
    <div class="bar-bg"><div id="lBar" class="bar-fill"></div></div>
    <div id="lDay" style="font-weight: bold; text-align: center;"></div>
</div>

<div class="widget">
    <h3>ğŸ§ é›†ä¸­ãƒã‚¤ã‚º</h3>
    <div class="flex" style="justify-content: space-around;">
        <button onclick="playN('brown')" style="background:#553311">ğŸŸ¤ Brown</button>
        <button onclick="playN('white')" style="background:#444466">âšª White</button>
        <button onclick="stopN()" style="background:#882222">Stop</button>
    </div>
</div>

<script>
    // åŸ·ç­†ç³»
    const txtIn = document.getElementById('txtIn');
    txtIn.addEventListener('input', () => {
        const len = txtIn.value.length;
        document.getElementById('timeE').innerText = (len/400).toFixed(1);
        const tg = document.getElementById('targ').value;
        if(tg) document.getElementById('tBar').style.width = Math.min((len/tg)*100, 100) + '%';
    });

    // Citation
    function copyCite() {
        const res = `${document.getElementById('cA').value} (${document.getElementById('cY').value}). ${document.getElementById('cT').value}.`;
        navigator.clipboard.writeText(res);
        alert("Copied!");
    }

    // ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ã‚¤ãƒãƒ¼
    let pT = 0, pI;
    function pStart() {
        if(pI) { clearInterval(pI); pI=null; return; }
        pI = setInterval(() => {
            pT++;
            const m = String(Math.floor(pT/60)).padStart(2,'0');
            const s = String(pT%60).padStart(2,'0');
            document.getElementById('pClock').innerText = `${m}:${s}`;
        }, 1000);
    }
    function pReset() { clearInterval(pI); pI=null; pT=0; document.getElementById('pClock').innerText = "00:00"; }

    // çµ±è¨ˆ
    function stat(v) {
        const m = {t:"tæ¤œå®š", u:"ãƒãƒ³ãƒ»ãƒ›ã‚¤ãƒƒãƒˆãƒ‹ãƒ¼ã®Uæ¤œå®š", a:"ä¸€å…ƒé…ç½®åˆ†æ•£åˆ†æ / Kruskal-Wallis", r:"Pearson / Spearman"};
        document.getElementById('sRes').innerText = m[v] || "é¸æŠã—ã¦ãã ã•ã„";
    }

    // ãƒ©ã‚¤ãƒ•
    function upL() {
        const n = new Date(), s = new Date(n.getFullYear(), 0, 1), e = new Date(n.getFullYear()+1, 0, 1);
        const p = ((n-s)/(e-s))*100;
        document.getElementById('lBar').style.width = p + '%';
        document.getElementById('lDay').innerText = `ä»Šå¹´ã®æ®‹ã‚Š: ${Math.ceil((new Date(n.getFullYear(),11,31)-n)/(1000*60*60*24))}æ—¥`;
    }
    upL();

    // ãƒã‚¤ã‚ºï¼ˆWeb Audio APIã‚’ä½¿ç”¨ï¼‰
    let audioCtx, noiseSource;
    function playN(type) {
        if(audioCtx) stopN();
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const bufferSize = 4096;
        noiseSource = audioCtx.createScriptProcessor(bufferSize, 1, 1);
        let lastOut = 0;
        noiseSource.onaudioprocess = (e) => {
            const out = e.outputBuffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                let white = Math.random() * 2 - 1;
                if(type === 'brown') {
                    out[i] = (lastOut + (0.02 * white)) / 1.02;
                    lastOut = out[i];
                    out[i] *= 3.5; // éŸ³é‡è£œæ­£
                } else { out[i] = white * 0.5; }
            }
        };
        noiseSource.connect(audioCtx.destination);
    }
    function stopN() { if(audioCtx) { audioCtx.close(); audioCtx = null; } }
</script>
</body>
</html>
